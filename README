This is based off the code Kees Cook wrote, which is avilable at http://outflux.net/geoloc/ .
